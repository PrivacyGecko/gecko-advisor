# Development Dockerfile for frontend (Vite dev server)
# Used for E2E testing with hot reload support

FROM node:22-alpine AS base

# Install pnpm
RUN corepack enable && corepack prepare pnpm@10.14.0 --activate

# Set working directory
WORKDIR /app

# Copy package files for dependency installation
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY apps/frontend/package.json ./apps/frontend/
COPY packages/shared/package.json ./packages/shared/
COPY infra/prisma/package.json ./infra/prisma/

# Install all dependencies
RUN pnpm install --frozen-lockfile

# Copy source code
COPY apps/frontend ./apps/frontend
COPY packages/shared ./packages/shared
COPY infra/prisma ./infra/prisma

# Build shared package
RUN pnpm --filter @privacy-advisor/shared build

# Expose Vite dev server port
EXPOSE 5173

# Start Vite dev server
# Note: --host 0.0.0.0 is crucial for Docker accessibility
CMD ["pnpm", "--filter", "@privacy-advisor/frontend", "dev", "--host", "0.0.0.0"]
